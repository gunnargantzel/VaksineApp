{
  "tableDefinition": {
    "name": "cr_patients",
    "displayName": "Patients",
    "description": "Patient information and demographics",
    "primaryNameAttribute": "cr_fullname",
    "tableType": "Standard",
    "ownershipType": "UserOwned",
    "isActivity": false,
    "isActivityParty": false,
    "isCustomizable": true,
    "isManaged": false,
    "isValidForAdvancedFind": true,
    "isValidForQueue": false,
    "isValidForMobile": true,
    "isValidForMobileOffline": true,
    "isValidForDuplicateDetection": true,
    "isAuditEnabled": true,
    "isChangeTrackingEnabled": true,
    "isMappable": true,
    "isRenameable": true,
    "isCustomizable": true,
    "isManaged": false,
    "isValidForAdvancedFind": true,
    "isValidForQueue": false,
    "isValidForMobile": true,
    "isValidForMobileOffline": true,
    "isValidForDuplicateDetection": true,
    "isAuditEnabled": true,
    "isChangeTrackingEnabled": true,
    "isMappable": true,
    "isRenameable": true,
    "columns": [
      {
        "name": "cr_patientid",
        "displayName": "Patient ID",
        "description": "Unique identifier for the patient",
        "dataType": "Uniqueidentifier",
        "isPrimaryKey": true,
        "isRequired": true,
        "isCustomizable": false,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": false,
        "isValidForRead": true,
        "isValidForUpdate": false,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": false
      },
      {
        "name": "cr_firstname",
        "displayName": "First Name",
        "description": "Patient's first name",
        "dataType": "String",
        "maxLength": 100,
        "isRequired": true,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": true,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_lastname",
        "displayName": "Last Name",
        "description": "Patient's last name",
        "dataType": "String",
        "maxLength": 100,
        "isRequired": true,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": true,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_fullname",
        "displayName": "Full Name",
        "description": "Patient's full name (computed field)",
        "dataType": "String",
        "maxLength": 200,
        "isRequired": false,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": false,
        "isValidForRead": true,
        "isValidForUpdate": false,
        "isValidForDuplicateDetection": true,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true,
        "formula": "cr_firstname & \" \" & cr_lastname"
      },
      {
        "name": "cr_dateofbirth",
        "displayName": "Date of Birth",
        "description": "Patient's date of birth",
        "dataType": "DateTime",
        "isRequired": true,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": true,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_personnummer",
        "displayName": "Personnummer",
        "description": "Norwegian personal identification number",
        "dataType": "String",
        "maxLength": 11,
        "isRequired": true,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": true,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_phone",
        "displayName": "Phone Number",
        "description": "Patient's contact phone number",
        "dataType": "String",
        "maxLength": 20,
        "isRequired": false,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_email",
        "displayName": "Email Address",
        "description": "Patient's contact email address",
        "dataType": "String",
        "maxLength": 100,
        "isRequired": false,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": true,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_address",
        "displayName": "Address",
        "description": "Patient's home address",
        "dataType": "String",
        "maxLength": 500,
        "isRequired": false,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_emergencycontact",
        "displayName": "Emergency Contact",
        "description": "Emergency contact information",
        "dataType": "String",
        "maxLength": 500,
        "isRequired": false,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_medicalconditions",
        "displayName": "Medical Conditions",
        "description": "Known medical conditions",
        "dataType": "String",
        "maxLength": 2000,
        "isRequired": false,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_allergies",
        "displayName": "Allergies",
        "description": "Known allergies",
        "dataType": "String",
        "maxLength": 2000,
        "isRequired": false,
        "isCustomizable": true,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": true
      },
      {
        "name": "cr_createdby",
        "displayName": "Created By",
        "description": "User who created the patient record",
        "dataType": "Lookup",
        "lookupTable": "systemuser",
        "isRequired": true,
        "isCustomizable": false,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": false,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": false
      },
      {
        "name": "cr_createdon",
        "displayName": "Created On",
        "description": "Date and time when the patient record was created",
        "dataType": "DateTime",
        "isRequired": true,
        "isCustomizable": false,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": true,
        "isValidForRead": true,
        "isValidForUpdate": false,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": false
      },
      {
        "name": "cr_modifiedby",
        "displayName": "Modified By",
        "description": "User who last modified the patient record",
        "dataType": "Lookup",
        "lookupTable": "systemuser",
        "isRequired": false,
        "isCustomizable": false,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": false,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": false
      },
      {
        "name": "cr_modifiedon",
        "displayName": "Modified On",
        "description": "Date and time when the patient record was last modified",
        "dataType": "DateTime",
        "isRequired": false,
        "isCustomizable": false,
        "isManaged": false,
        "isValidForAdvancedFind": true,
        "isValidForCreate": false,
        "isValidForRead": true,
        "isValidForUpdate": true,
        "isValidForDuplicateDetection": false,
        "isAuditEnabled": true,
        "isChangeTrackingEnabled": true,
        "isMappable": true,
        "isRenameable": false
      }
    ],
    "relationships": [
      {
        "name": "cr_patient_vaccinerecords",
        "type": "OneToMany",
        "relatedTable": "cr_vaccinerecords",
        "relatedColumn": "cr_patientid",
        "cascadeConfiguration": {
          "assign": "Cascade",
          "delete": "Restrict",
          "merge": "Cascade",
          "reparent": "Cascade",
          "share": "Cascade",
          "unshare": "Cascade"
        }
      },
      {
        "name": "cr_patient_appointments",
        "type": "OneToMany",
        "relatedTable": "cr_appointments",
        "relatedColumn": "cr_patientid",
        "cascadeConfiguration": {
          "assign": "Cascade",
          "delete": "Restrict",
          "merge": "Cascade",
          "reparent": "Cascade",
          "share": "Cascade",
          "unshare": "Cascade"
        }
      }
    ],
    "indexes": [
      {
        "name": "cr_patients_personnummer",
        "columns": ["cr_personnummer"],
        "isUnique": true,
        "isClustered": false
      },
      {
        "name": "cr_patients_email",
        "columns": ["cr_email"],
        "isUnique": false,
        "isClustered": false
      },
      {
        "name": "cr_patients_name",
        "columns": ["cr_lastname", "cr_firstname"],
        "isUnique": false,
        "isClustered": false
      }
    ],
    "businessRules": [
      {
        "name": "Validate Personnummer",
        "description": "Validate Norwegian personal number format",
        "condition": "cr_personnummer is not null",
        "actions": [
          {
            "type": "Validation",
            "message": "Personnummer must be in format DDMMYY-XXXXX",
            "formula": "Len(cr_personnummer) = 11 && IsMatch(cr_personnummer, \"^[0-9]{6}-[0-9]{5}$\")"
          }
        ]
      },
      {
        "name": "Validate Email",
        "description": "Validate email format if provided",
        "condition": "cr_email is not null",
        "actions": [
          {
            "type": "Validation",
            "message": "Email must be in valid format",
            "formula": "IsMatch(cr_email, \"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$\")"
          }
        ]
      }
    ]
  }
}
